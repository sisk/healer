- patient = diagnosis.patient
.dialog-form.review_diagnosis{ :id => "form_#{dom_id(diagnosis)}" }
  - if diagnosis.xrays.present?
    .xrays
      - diagnosis.xrays.each do |xray|
        - if xray.photo.exists?
          .enlarge
            = link_to image_tag(xray.photo.url(:small), :alt => xray.to_s, :class => "xray"), xray.photo.url, :rel => "group"
            %p [click to enlarge]

      =# render :partial => 'diagnoses/xray', :collection => diagnosis.xrays, :locals => { :f => f }
  - semantic_form_for [patient,diagnosis], :html => { :multipart => true } do |f|
    = f.semantic_errors
    = f.input :patient_id, :as => :hidden, :input_html => { :value => patient.id }
    - f.inputs do
      = f.input :body_part_id, :as => :select, :label => 'Body Part', :collection => BodyPart.all.collect{ |bp| [bp.to_s, bp.id] }, :input_html => { :id => "body_part_#{dom_id(diagnosis)}" }
      = f.input :disease_id, :as => :select, :label => 'Disease', :collection => Disease.all.collect{ |d| [d.to_s, d.id] }, :input_html => { :id => "disease_#{dom_id(diagnosis)}" }
      = f.input :severity, :as => :radio, :label => "Severity", :collection => Diagnosis::severity_table.invert
    - f.buttons do
      = f.commit_button