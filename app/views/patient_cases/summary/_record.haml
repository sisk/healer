- # TODO this is very similar to inline_patient_case view. dry it up!.
- patient = patient_case.patient
.patient_case[patient_case]
  .patient
    .image= patient_image(patient, :small)
    .primary.name
      %h3= patient
      %h4
        - if permitted_to? :show, patient_case
          = link_to "Case ##{patient_case.id}", trip_case_path(patient_case.trip, patient_case)
        - else
          = "Case ##{patient_case.id}"
    .secondary.demographic
      = render :partial => "patients/shared/patient_demographic", :locals => { :patient => patient_case.patient }
    .navigation.noprint
      = render :partial => "patient_cases/summary/action", :locals => { :patient_case => patient_case }
  - if patient.has_medical_detail?
    .medical_details.supplemental
      %p.fake_link.toggle= "Full medical detail"
      .details{ :style => "display: none;" }
        = render :partial => "patients/medical_details", :locals => { :patient => patient_case.patient, :hide => true }
  .section.treatment
    .title_header
      .pre_op
        %h3 Pre-Op
        - if patient_case.diagnosis
          = render :partial => "diagnoses/inline", :object => patient_case.diagnosis, :as => :diagnosis, :locals => { :options => { :remote => true, :size => :tiny, :context => :patient_case } }
        - else
          %p= link_to "Add diagnosis", new_case_diagnosis_path(patient_case)
        .xrays
          - if patient_case.xrays.present?
            = xray_preview(patient_case.display_xray)
            - if patient_case.xrays.size > 1
              = link_to "More X-rays", case_xrays_path(patient_case)
          = link_to "Add X-ray", new_case_xray_path(patient_case)

      .operation
        %h3 Operation
        .operation
          - if patient_case.operations.empty?
            = link_to "New operation", new_case_operation_path(patient_case)
          - else
            - patient_case.operations.each do |operation|
              = render :partial => "operations/inline", :object => operation, :as => :operation, :locals => { :options => { :size => :tiny } }