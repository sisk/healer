%div{ "data-magellan-expedition" => "fixed" }
  %dl.sub-nav
    %dd{ "data-magellan-arrival" => "basic" }
      %a{ href: "#basic" }Basic Info
    %dd{ "data-magellan-arrival" => "risks" }
      %a{ href: "#risks" }Risk Factors
    %dd{ "data-magellan-arrival" => "history" }
      %a{ href: "#history"}Medical History
    %dd{ "data-magellan-arrival" => "contact" }
      %a{ href: "#contact" }Contact

= simple_form_for @patient, :html => { :multipart => true, :id => "patient_edit" } do |f|
  = f.error_notification

  %a{ :name => "basic" }
  %h3{ "data-magellan-destination" => "basic" }Basic Info
  = f.input :name_full, :label => "Name"
  - if @patient.photo.present?
    = patient_image(@patient, :small)
  = f.input :photo, :as => :file, :label => "Change Photo"

  = f.input :male, :as => :radio, :label => "Gender", :collection => [["Male", true], ["Female", false]]
  = f.input :birth, :as => :date, :label => "Birth", :start_year => 1900, :end_year => Time.now.year
  =# f.input :death, :as => :date, :label => "Death"
  = f.input :height_cm, :label => 'Height', :wrapper_html => { :class => 'supplemented' }
  = f.input :height_unit, :label => false, :wrapper_html => { :class => 'supplemental' }, :collection => ['centimeters','inches'], :selected => 'centimeters'
  = f.input :weight_kg, :label => 'Weight', :wrapper_html => { :class => 'supplemented' }
  = f.input :weight_unit, :label => false, :as => :select, :wrapper_html => { :class => 'supplemental' }, :collection => ['kilograms','pounds'], :selected => 'kilograms'

  %a{ :name => "risks" }
  %h3{ "data-magellan-destination" => "risks" }Risk Factors
  = render :partial => 'risk_factor', :collection => @patient.risk_factors, :locals => { :f => f }
  - if permitted_to? :create, RiskFactor.new(:patient => @patient)
    #new_risk_factors
    = link_to_function 'Add a risk factor', "$('#new_risk_factors').append('#{escape_javascript render :partial => 'new_risk_factor', :object => RiskFactor.new(:patient => @patient), :locals => { :f => f }}');$(this).remove();", :id => "add_risk_factor"

  %a{ :name => "history" }
  %h3{ "data-magellan-destination" => "history" }Medical History
  = f.input :medications, :label => false, :hint => "Separate entries with commas or return."
  = f.input :other_diseases, :label => false, :hint => "Separate entries with commas or return."
  = f.input :allergies, :label => false, :hint => "Separate entries with commas or return."

  %a{ :name => "contact" }
  %h3{ "data-magellan-destination" => "contact" }Contact
  = f.input :address1, :label => 'Address 1'
  = f.input :address2, :label => 'Address 2'
  = f.input :city, :label => 'City'
  = f.input :state, :label => 'State/Region'
  = f.input :zip, :label => 'Zip/Postal'
  = f.input :country, :as => :select, :label => 'Country', :collection => all_countries
  = f.input :phone, :label => 'Phone'
  = f.input :email, :label => 'Email'

  = f.button :submit