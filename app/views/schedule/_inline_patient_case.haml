- # TODO this is very similar to cases/record view. dry it up!.
- patient = patient_case.patient
.patient_case[patient_case]
  .patient
    .image= patient_image(patient, :small)
    .primary.name
      %h3= patient
      %h4
        - if permitted_to? :show, patient_case
          = link_to "Case ##{patient_case.id}", trip_case_path(patient_case.trip, patient_case)
        - else
          = "Case ##{patient_case.id}"
    .secondary.demographic
      = render :partial => "patients/shared/patient_demographic", :locals => { :patient => patient }
    .navigation.noprint
      %ul
        - if permitted_to? :unschedule, patient_case
          %li= link_to "Remove from schedule", unschedule_case_path(patient_case), :method => :put, :confirm => "Are you sure? This case will be removed from the schedule and will need to be rescheduled for an operation to take place."
        - if permitted_to? :destroy, patient_case
          %li.delete= link_to "Delete case", case_path(patient_case), :method => :delete, :confirm => "Are you sure? You want to do this? This will completely delete this case."
        - if permitted_to? :edit, patient_case.patient
          %li= link_to "Edit patient", edit_patient_path(patient_case.patient)
        %li= link_to "Physical Therapy", patient_case_physical_therapies_path(patient_case)

      /   - if patient_case.operations.present?
      /     %li= link_to "Summary Report", patient_case
  - if patient.has_medical_detail?
    .section.medical_details.supplemental
      %p.fake_link.toggle= "Full medical detail"
      .details{ :style => "display: none;" }
        = render :partial => "patients/medical_details", :locals => { :patient => patient, :hide => true }
  .section.treatment
    .title_header
      %h3.diagnosis Diagnosis / Pre-Op
      %h3.operation Operation
    - patient_case.diagnoses.each do |diagnosis|
      .diagnosis_and_operation
        .diagnosis
          = render :partial => "diagnoses/inline", :object => diagnosis, :as => :diagnosis, :locals => { :options => { :remote => true, :size => :tiny, :context => :patient_case } }
        .operation
          - if diagnosis.operation.empty?
            = link_to "New operation for this diagnosis", new_diagnosis_operation_path(diagnosis)
          - else
            = render :partial => "operations/inline", :object => diagnosis.operation, :as => :operation, :locals => { :options => { :size => :tiny } }