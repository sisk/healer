/*
 * Pixastic - JavaScript Image Processing Library
 * Copyright (c) 2008 Jacob Seidelin, jseidelin@nihilogic.dk, http://blog.nihilogic.dk/
 * MIT License [http://www.pixastic.com/lib/license.txt]
 */
var Pixastic=function(){function e(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n)}function t(t){var n=!1,r=function(){n||(n=!0,t())};document.write('<script defer src="//:" id="__onload_ie_pixastic__"></script>');var i=document.getElementById("__onload_ie_pixastic__");i.onreadystatechange=function(){i.readyState=="complete"&&(i.parentNode.removeChild(i),r())},document.addEventListener&&document.addEventListener("DOMContentLoaded",r,!1),e(window,"load",r)}function n(){var e=r("pixastic",null,"img"),t=r("pixastic",null,"canvas"),n=e.concat(t);for(var i=0;i<n.length;i++)(function(){var e=n[i],t=[],r=e.className.split(" ");for(var s=0;s<r.length;s++){var o=r[s];if(o.substring(0,9)=="pixastic-"){var u=o.substring(9);u!=""&&t.push(u)}}if(t.length)if(e.tagName.toLowerCase()=="img"){var a=new Image;a.src=e.src;if(a.complete)for(var f=0;f<t.length;f++){var l=Pixastic.applyAction(e,e,t[f],null);l&&(e=l)}else a.onload=function(){for(var n=0;n<t.length;n++){var r=Pixastic.applyAction(e,e,t[n],null);r&&(e=r)}}}else setTimeout(function(){for(var n=0;n<t.length;n++){var r=Pixastic.applyAction(e,e,t[n],null);r&&(e=r)}},1)})()}function r(e,t,n){var r=new Array;t==null&&(t=document),n==null&&(n="*");var s=t.getElementsByTagName(n),o=s.length,u=new RegExp("(^|\\s)"+e+"(\\s|$)");for(i=0,j=0;i<o;i++)u.test(s[i].className)&&(r[j]=s[i],j++);return r}function o(e,t){if(!Pixastic.debug)return;try{switch(t){case"warn":console.warn("Pixastic:",e);break;case"error":console.error("Pixastic:",e);break;default:console.log("Pixastic:",e)}}catch(n){}!s}typeof pixastic_parseonload!="undefined"&&pixastic_parseonload&&t(n);var s,u=function(){var e=document.createElement("canvas"),t=!1;try{t=typeof e.getContext=="function"&&!!e.getContext("2d")}catch(n){}return function(){return t}}(),a=function(){var e=document.createElement("canvas"),t=!1,n;try{typeof e.getContext=="function"&&(n=e.getContext("2d"))&&(t=typeof n.getImageData=="function")}catch(r){}return function(){return t}}(),f=function(){var e=!1,t=document.createElement("canvas");if(u()&&a()){t.width=t.height=1;var n=t.getContext("2d");n.fillStyle="rgb(255,0,0)",n.fillRect(0,0,1,1);var r=document.createElement("canvas");r.width=r.height=1;var i=r.getContext("2d");i.fillStyle="rgb(0,0,255)",i.fillRect(0,0,1,1),n.globalAlpha=.5,n.drawImage(r,0,0);var s=n.getImageData(0,0,1,1).data;e=s[2]!=255}return function(){return e}}();return{parseOnLoad:!1,debug:!1,applyAction:function(e,t,n,r){r=r||{};var i=e.tagName.toLowerCase()=="canvas";if(i&&Pixastic.Client.isIE())return Pixastic.debug&&o("Tried to process a canvas element but browser is IE."),!1;var s,u,a=!1;Pixastic.Client.hasCanvas()&&(a=!!r.resultCanvas,s=r.resultCanvas||document.createElement("canvas"),u=s.getContext("2d"));var f=e.offsetWidth,l=e.offsetHeight;i&&(f=e.width,l=e.height);if(f==0||l==0){if(e.parentNode!=null){Pixastic.debug&&o("Image has 0 width and/or height.");return}var c=e.style.position,h=e.style.left;e.style.position="absolute",e.style.left="-9999px",document.body.appendChild(e),f=e.offsetWidth,l=e.offsetHeight,document.body.removeChild(e),e.style.position=c,e.style.left=h}if(n.indexOf("(")>-1){var p=n;n=p.substr(0,p.indexOf("("));var d=p.match(/\((.*?)\)/);if(d[1]){d=d[1].split(";");for(var v=0;v<d.length;v++){thisArg=d[v].split("=");if(thisArg.length==2)if(thisArg[0]=="rect"){var m=thisArg[1].split(",");r[thisArg[0]]={left:parseInt(m[0],10)||0,top:parseInt(m[1],10)||0,width:parseInt(m[2],10)||0,height:parseInt(m[3],10)||0}}else r[thisArg[0]]=thisArg[1]}}}r.rect?(r.rect.left=Math.round(r.rect.left),r.rect.top=Math.round(r.rect.top),r.rect.width=Math.round(r.rect.width),r.rect.height=Math.round(r.rect.height)):r.rect={left:0,top:0,width:f,height:l};var g=!1;Pixastic.Actions[n]&&typeof Pixastic.Actions[n].process=="function"&&(g=!0);if(!g)return Pixastic.debug&&o('Invalid action "'+n+'". Maybe file not included?'),!1;if(!Pixastic.Actions[n].checkSupport())return Pixastic.debug&&o('Action "'+n+'" not supported by this browser.'),!1;Pixastic.Client.hasCanvas()?(s!==e&&(s.width=f,s.height=l),a||(s.style.width=f+"px",s.style.height=l+"px"),u.drawImage(t,0,0,f,l),e.__pixastic_org_image?(s.__pixastic_org_image=e.__pixastic_org_image,s.__pixastic_org_width=e.__pixastic_org_width,s.__pixastic_org_height=e.__pixastic_org_height):(s.__pixastic_org_image=e,s.__pixastic_org_width=f,s.__pixastic_org_height=l)):Pixastic.Client.isIE()&&typeof e.__pixastic_org_style=="undefined"&&(e.__pixastic_org_style=e.style.cssText);var y={image:e,canvas:s,width:f,height:l,useData:!0,options:r},b=Pixastic.Actions[n].process(y);return b?Pixastic.Client.hasCanvas()?(y.useData&&Pixastic.Client.hasCanvasImageData()&&(s.getContext("2d").putImageData(y.canvasData,r.rect.left,r.rect.top),s.getContext("2d").fillRect(0,0,0,0)),r.leaveDOM||(s.title=e.title,s.imgsrc=e.imgsrc,i||(s.alt=e.alt),i||(s.imgsrc=e.src),s.className=e.className,s.style.cssText=e.style.cssText,s.name=e.name,s.tabIndex=e.tabIndex,s.id=e.id,e.parentNode&&e.parentNode.replaceChild&&e.parentNode.replaceChild(s,e)),r.resultCanvas=s,s):e:!1},prepareData:function(e,t){var n=e.canvas.getContext("2d"),r=e.options.rect,i=n.getImageData(r.left,r.top,r.width,r.height),s=i.data;return t||(e.canvasData=i),s},process:function(e,t,n,r){if(e.tagName.toLowerCase()=="img"){var i=new Image;i.src=e.src;if(i.complete){var s=Pixastic.applyAction(e,i,t,n);return r&&r(s),s}i.onload=function(){var s=Pixastic.applyAction(e,i,t,n);r&&r(s)}}if(e.tagName.toLowerCase()=="canvas"){var s=Pixastic.applyAction(e,e,t,n);return r&&r(s),s}},revert:function(e){if(Pixastic.Client.hasCanvas()){if(e.tagName.toLowerCase()=="canvas"&&e.__pixastic_org_image)return e.width=e.__pixastic_org_width,e.height=e.__pixastic_org_height,e.getContext("2d").drawImage(e.__pixastic_org_image,0,0),e.parentNode&&e.parentNode.replaceChild&&e.parentNode.replaceChild(e.__pixastic_org_image,e),e}else Pixastic.Client.isIE()&&typeof e.__pixastic_org_style!="undefined"&&(e.style.cssText=e.__pixastic_org_style)},Client:{hasCanvas:u,hasCanvasImageData:a,hasGlobalAlpha:f,isIE:function(){return!!document.all&&!!window.attachEvent&&!window.opera}},Actions:{}}}();typeof jQuery!="undefined"&&jQuery&&jQuery.fn&&(jQuery.fn.pixastic=function(e,t){var n=[];return this.each(function(){if(this.tagName.toLowerCase()=="img"&&!this.complete)return;var r=Pixastic.process(this,e,t);r&&n.push(r)}),n.length>0?jQuery(n):this}),Pixastic.Actions.crop={process:function(e){if(Pixastic.Client.hasCanvas()){var t=e.options.rect,n=t.width,r=t.height,i=t.top,s=t.left;typeof e.options.left!="undefined"&&(s=parseInt(e.options.left,10)),typeof e.options.top!="undefined"&&(i=parseInt(e.options.top,10)),typeof e.options.height!="undefined"&&(n=parseInt(e.options.width,10)),typeof e.options.height!="undefined"&&(r=parseInt(e.options.height,10)),s<0&&(s=0),s>e.width-1&&(s=e.width-1),i<0&&(i=0),i>e.height-1&&(i=e.height-1),n<1&&(n=1),s+n>e.width&&(n=e.width-s),r<1&&(r=1),i+r>e.height&&(r=e.height-i);var o=document.createElement("canvas");return o.width=e.width,o.height=e.height,o.getContext("2d").drawImage(e.canvas,0,0),e.canvas.width=n,e.canvas.height=r,e.canvas.getContext("2d").clearRect(0,0,n,r),e.canvas.getContext("2d").drawImage(o,s,i,n,r,0,0,n,r),e.useData=!1,!0}},checkSupport:function(){return Pixastic.Client.hasCanvas()}},Pixastic.Actions.desaturate={process:function(e){var t=!!e.options.average&&e.options.average!="false";if(Pixastic.Client.hasCanvasImageData()){var n=Pixastic.prepareData(e),r=e.options.rect,i=r.width,s=r.height,o=i*s,u=o*4,a,f;if(t)while(o--)n[u-=4]=n[a=u+1]=n[f=u+2]=(n[u]+n[a]+n[f])/3;else while(o--)n[u-=4]=n[a=u+1]=n[f=u+2]=n[u]*.3+n[a]*.59+n[f]*.11;return!0}if(Pixastic.Client.isIE())return e.image.style.filter+=" gray",!0},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()||Pixastic.Client.isIE()}},Pixastic.Actions.fliph={process:function(e){if(Pixastic.Client.hasCanvas()){var t=e.options.rect,n=document.createElement("canvas");n.width=t.width,n.height=t.height,n.getContext("2d").drawImage(e.image,t.left,t.top,t.width,t.height,0,0,t.width,t.height);var r=e.canvas.getContext("2d");return r.clearRect(t.left,t.top,t.width,t.height),r.scale(-1,1),r.drawImage(n,-t.left-t.width,t.top,t.width,t.height),e.useData=!1,!0}if(Pixastic.Client.isIE())return e.image.style.filter+=" fliph",!0},checkSupport:function(){return Pixastic.Client.hasCanvas()||Pixastic.Client.isIE()}},Pixastic.Actions.flipv={process:function(e){if(Pixastic.Client.hasCanvas()){var t=e.options.rect,n=document.createElement("canvas");n.width=t.width,n.height=t.height,n.getContext("2d").drawImage(e.image,t.left,t.top,t.width,t.height,0,0,t.width,t.height);var r=e.canvas.getContext("2d");return r.clearRect(t.left,t.top,t.width,t.height),r.scale(1,-1),r.drawImage(n,t.left,-t.top-t.height,t.width,t.height),e.useData=!1,!0}if(Pixastic.Client.isIE())return e.image.style.filter+=" flipv",!0},checkSupport:function(){return Pixastic.Client.hasCanvas()||Pixastic.Client.isIE()}};