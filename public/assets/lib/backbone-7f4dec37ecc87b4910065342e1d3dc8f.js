//     Backbone.js 0.5.3
//     (c) 2010 Jeremy Ashkenas, DocumentCloud Inc.
//     Backbone may be freely distributed under the MIT license.
//     For all details and documentation:
//     http://documentcloud.github.com/backbone
(function(){var e=this,t=e.Backbone,n;typeof exports!="undefined"?n=exports:n=e.Backbone={},n.VERSION="0.5.3";var r=e._;!r&&typeof require!="undefined"&&(r=require("underscore")._);var i=e.jQuery||e.Zepto;n.noConflict=function(){return e.Backbone=t,this},n.emulateHTTP=!1,n.emulateJSON=!1,n.Events={bind:function(e,t,n){var r=this._callbacks||(this._callbacks={}),i=r[e]||(r[e]=[]);return i.push([t,n]),this},unbind:function(e,t){var n;if(!e)this._callbacks={};else if(n=this._callbacks)if(!t)n[e]=[];else{var r=n[e];if(!r)return this;for(var i=0,s=r.length;i<s;i++)if(r[i]&&t===r[i][0]){r[i]=null;break}}return this},trigger:function(e){var t,n,r,i,s,o=2;if(!(n=this._callbacks))return this;while(o--){r=o?e:"all";if(t=n[r])for(var u=0,a=t.length;u<a;u++)(i=t[u])?(s=o?Array.prototype.slice.call(arguments,1):arguments,i[0].apply(i[1]||this,s)):(t.splice(u,1),u--,a--)}return this}},n.Model=function(e,t){var n;e||(e={});if(n=this.defaults)r.isFunction(n)&&(n=n.call(this)),e=r.extend({},n,e);this.attributes={},this._escapedAttributes={},this.cid=r.uniqueId("c"),this.set(e,{silent:!0}),this._changed=!1,this._previousAttributes=r.clone(this.attributes),t&&t.collection&&(this.collection=t.collection),this.initialize(e,t)},r.extend(n.Model.prototype,n.Events,{_previousAttributes:null,_changed:!1,idAttribute:"id",initialize:function(){},toJSON:function(){return r.clone(this.attributes)},get:function(e){return this.attributes[e]},escape:function(e){var t;if(t=this._escapedAttributes[e])return t;var n=this.attributes[e];return this._escapedAttributes[e]=S(n==null?"":""+n)},has:function(e){return this.attributes[e]!=null},set:function(e,t){t||(t={});if(!e)return this;e.attributes&&(e=e.attributes);var n=this.attributes,i=this._escapedAttributes;if(!t.silent&&this.validate&&!this._performValidation(e,t))return!1;this.idAttribute in e&&(this.id=e[this.idAttribute]);var s=this._changing;this._changing=!0;for(var o in e){var u=e[o];r.isEqual(n[o],u)||(n[o]=u,delete i[o],this._changed=!0,t.silent||this.trigger("change:"+o,this,u,t))}return!s&&!t.silent&&this._changed&&this.change(t),this._changing=!1,this},unset:function(e,t){if(e in this.attributes){t||(t={});var n=this.attributes[e],r={};return r[e]=void 0,!t.silent&&this.validate&&!this._performValidation(r,t)?!1:(delete this.attributes[e],delete this._escapedAttributes[e],e==this.idAttribute&&delete this.id,this._changed=!0,t.silent||(this.trigger("change:"+e,this,void 0,t),this.change(t)),this)}return this},clear:function(e){e||(e={});var t,n=this.attributes,r={};for(t in n)r[t]=void 0;if(!e.silent&&this.validate&&!this._performValidation(r,e))return!1;this.attributes={},this._escapedAttributes={},this._changed=!0;if(!e.silent){for(t in n)this.trigger("change:"+t,this,void 0,e);this.change(e)}return this},fetch:function(e){e||(e={});var t=this,r=e.success;return e.success=function(n,i,s){if(!t.set(t.parse(n,s),e))return!1;r&&r(t,n)},e.error=E(e.error,t,e),(this.sync||n.sync).call(this,"read",this,e)},save:function(e,t){t||(t={});if(e&&!this.set(e,t))return!1;var r=this,i=t.success;t.success=function(e,n,s){if(!r.set(r.parse(e,s),t))return!1;i&&i(r,e,s)},t.error=E(t.error,r,t);var s=this.isNew()?"create":"update";return(this.sync||n.sync).call(this,s,this,t)},destroy:function(e){e||(e={});if(this.isNew())return this.trigger("destroy",this,this.collection,e);var t=this,r=e.success;return e.success=function(n){t.trigger("destroy",t,t.collection,e),r&&r(t,n)},e.error=E(e.error,t,e),(this.sync||n.sync).call(this,"delete",this,e)},url:function(){var e=b(this.collection)||this.urlRoot||w();return this.isNew()?e:e+(e.charAt(e.length-1)=="/"?"":"/")+encodeURIComponent(this.id)},parse:function(e,t){return e},clone:function(){return new this.constructor(this)},isNew:function(){return this.id==null},change:function(e){this.trigger("change",this,e),this._previousAttributes=r.clone(this.attributes),this._changed=!1},hasChanged:function(e){return e?this._previousAttributes[e]!=this.attributes[e]:this._changed},changedAttributes:function(e){e||(e=this.attributes);var t=this._previousAttributes,n=!1;for(var i in e)r.isEqual(t[i],e[i])||(n=n||{},n[i]=e[i]);return n},previous:function(e){return!e||!this._previousAttributes?null:this._previousAttributes[e]},previousAttributes:function(){return r.clone(this._previousAttributes)},_performValidation:function(e,t){var n=this.validate(e);return n?(t.error?t.error(this,n,t):this.trigger("error",this,n,t),!1):!0}}),n.Collection=function(e,t){t||(t={}),t.comparator&&(this.comparator=t.comparator),r.bindAll(this,"_onModelEvent","_removeReference"),this._reset(),e&&this.reset(e,{silent:!0}),this.initialize.apply(this,arguments)},r.extend(n.Collection.prototype,n.Events,{model:n.Model,initialize:function(){},toJSON:function(){return this.map(function(e){return e.toJSON()})},add:function(e,t){if(r.isArray(e))for(var n=0,i=e.length;n<i;n++)this._add(e[n],t);else this._add(e,t);return this},remove:function(e,t){if(r.isArray(e))for(var n=0,i=e.length;n<i;n++)this._remove(e[n],t);else this._remove(e,t);return this},get:function(e){return e==null?null:this._byId[e.id!=null?e.id:e]},getByCid:function(e){return e&&this._byCid[e.cid||e]},at:function(e){return this.models[e]},sort:function(e){e||(e={});if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return this.models=this.sortBy(this.comparator),e.silent||this.trigger("reset",this,e),this},pluck:function(e){return r.map(this.models,function(t){return t.get(e)})},reset:function(e,t){return e||(e=[]),t||(t={}),this.each(this._removeReference),this._reset(),this.add(e,{silent:!0}),t.silent||this.trigger("reset",this,t),this},fetch:function(e){e||(e={});var t=this,r=e.success;return e.success=function(n,i,s){t[e.add?"add":"reset"](t.parse(n,s),e),r&&r(t,n)},e.error=E(e.error,t,e),(this.sync||n.sync).call(this,"read",this,e)},create:function(e,t){var n=this;t||(t={}),e=this._prepareModel(e,t);if(!e)return!1;var r=t.success;return t.success=function(e,i,s){n.add(e,t),r&&r(e,i,s)},e.save(null,t),e},parse:function(e,t){return e},chain:function(){return r(this.models).chain()},_reset:function(e){this.length=0,this.models=[],this._byId={},this._byCid={}},_prepareModel:function(e,t){if(e instanceof n.Model)e.collection||(e.collection=this);else{var r=e;e=new this.model(r,{collection:this}),e.validate&&!e._performValidation(r,t)&&(e=!1)}return e},_add:function(e,t){t||(t={}),e=this._prepareModel(e,t);if(!e)return!1;var n=this.getByCid(e);if(n)throw new Error(["Can't add the same model to a set twice",n.id]);this._byId[e.id]=e,this._byCid[e.cid]=e;var r=t.at!=null?t.at:this.comparator?this.sortedIndex(e,this.comparator):this.length;return this.models.splice(r,0,e),e.bind("all",this._onModelEvent),this.length++,t.silent||e.trigger("add",e,this,t),e},_remove:function(e,t){return t||(t={}),e=this.getByCid(e)||this.get(e),e?(delete this._byId[e.id],delete this._byCid[e.cid],this.models.splice(this.indexOf(e),1),this.length--,t.silent||e.trigger("remove",e,this,t),this._removeReference(e),e):null},_removeReference:function(e){this==e.collection&&delete e.collection,e.unbind("all",this._onModelEvent)},_onModelEvent:function(e,t,n,r){if((e=="add"||e=="remove")&&n!=this)return;e=="destroy"&&this._remove(t,r),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],this._byId[t.id]=t),this.trigger.apply(this,arguments)}});var s=["forEach","each","map","reduce","reduceRight","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","sortBy","sortedIndex","toArray","size","first","rest","last","without","indexOf","lastIndexOf","isEmpty","groupBy"];r.each(s,function(e){n.Collection.prototype[e]=function(){return r[e].apply(r,[this.models].concat(r.toArray(arguments)))}}),n.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)};var o=/:([\w\d]+)/g,u=/\*([\w\d]+)/g,a=/[-[\]{}()+?.,\\^$|#\s]/g;r.extend(n.Router.prototype,n.Events,{initialize:function(){},route:function(e,t,i){n.history||(n.history=new n.History),r.isRegExp(e)||(e=this._routeToRegExp(e)),n.history.route(e,r.bind(function(n){var r=this._extractParameters(e,n);i.apply(this,r),this.trigger.apply(this,["route:"+t].concat(r))},this))},navigate:function(e,t){n.history.navigate(e,t)},_bindRoutes:function(){if(!this.routes)return;var e=[];for(var t in this.routes)e.unshift([t,this.routes[t]]);for(var n=0,r=e.length;n<r;n++)this.route(e[n][0],e[n][1],this[e[n][1]])},_routeToRegExp:function(e){return e=e.replace(a,"\\$&").replace(o,"([^/]*)").replace(u,"(.*?)"),new RegExp("^"+e+"$")},_extractParameters:function(e,t){return e.exec(t).slice(1)}}),n.History=function(){this.handlers=[],r.bindAll(this,"checkUrl")};var f=/^#*/,l=/msie [\w.]+/,c=!1;r.extend(n.History.prototype,{interval:50,getFragment:function(e,t){if(e==null)if(this._hasPushState||t){e=window.location.pathname;var n=window.location.search;n&&(e+=n),e.indexOf(this.options.root)==0&&(e=e.substr(this.options.root.length))}else e=window.location.hash;return decodeURIComponent(e.replace(f,""))},start:function(e){if(c)throw new Error("Backbone.history has already been started");this.options=r.extend({},{root:"/"},this.options,e),this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&window.history&&window.history.pushState);var t=this.getFragment(),n=document.documentMode,s=l.exec(navigator.userAgent.toLowerCase())&&(!n||n<=7);s&&(this.iframe=i('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(t)),this._hasPushState?i(window).bind("popstate",this.checkUrl):"onhashchange"in window&&!s?i(window).bind("hashchange",this.checkUrl):setInterval(this.checkUrl,this.interval),this.fragment=t,c=!0;var o=window.location,u=o.pathname==this.options.root;if(this._wantsPushState&&!this._hasPushState&&!u)return this.fragment=this.getFragment(null,!0),window.location.replace(this.options.root+"#"+this.fragment),!0;this._wantsPushState&&this._hasPushState&&u&&o.hash&&(this.fragment=o.hash.replace(f,""),window.history.replaceState({},document.title,o.protocol+"//"+o.host+this.options.root+this.fragment));if(!this.options.silent)return this.loadUrl()},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();t==this.fragment&&this.iframe&&(t=this.getFragment(this.iframe.location.hash));if(t==this.fragment||t==decodeURIComponent(this.fragment))return!1;this.iframe&&this.navigate(t),this.loadUrl()||this.loadUrl(window.location.hash)},loadUrl:function(e){var t=this.fragment=this.getFragment(e),n=r.any(this.handlers,function(e){if(e.route.test(t))return e.callback(t),!0});return n},navigate:function(e,t){var n=(e||"").replace(f,"");if(this.fragment==n||this.fragment==decodeURIComponent(n))return;if(this._hasPushState){var r=window.location;n.indexOf(this.options.root)!=0&&(n=this.options.root+n),this.fragment=n,window.history.pushState({},document.title,r.protocol+"//"+r.host+n)}else window.location.hash=this.fragment=n,this.iframe&&n!=this.getFragment(this.iframe.location.hash)&&(this.iframe.document.open().close(),this.iframe.location.hash=n);t&&this.loadUrl(e)}}),n.View=function(e){this.cid=r.uniqueId("view"),this._configure(e||{}),this._ensureElement(),this.delegateEvents(),this.initialize.apply(this,arguments)};var h=function(e){return i(e,this.el)},p=/^(\S+)\s*(.*)$/,d=["model","collection","el","id","attributes","className","tagName"];r.extend(n.View.prototype,n.Events,{tagName:"div",$:h,initialize:function(){},render:function(){return this},remove:function(){return i(this.el).remove(),this},make:function(e,t,n){var r=document.createElement(e);return t&&i(r).attr(t),n&&i(r).html(n),r},delegateEvents:function(e){if(!e&&!(e=this.events))return;r.isFunction(e)&&(e=e.call(this)),i(this.el).unbind(".delegateEvents"+this.cid);for(var t in e){var n=this[e[t]];if(!n)throw new Error('Event "'+e[t]+'" does not exist');var s=t.match(p),o=s[1],u=s[2];n=r.bind(n,this),o+=".delegateEvents"+this.cid,u===""?i(this.el).bind(o,n):i(this.el).delegate(u,o,n)}},_configure:function(e){this.options&&(e=r.extend({},this.options,e));for(var t=0,n=d.length;t<n;t++){var i=d[t];e[i]&&(this[i]=e[i])}this.options=e},_ensureElement:function(){if(!this.el){var e=this.attributes||{};this.id&&(e.id=this.id),this.className&&(e["class"]=this.className),this.el=this.make(this.tagName,e)}else r.isString(this.el)&&(this.el=i(this.el).get(0))}});var v=function(e,t){var n=y(this,e,t);return n.extend=this.extend,n};n.Model.extend=n.Collection.extend=n.Router.extend=n.View.extend=v;var m={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};n.sync=function(e,t,s){var o=m[e],u=r.extend({type:o,dataType:"json"},s);return u.url||(u.url=b(t)||w()),!u.data&&t&&(e=="create"||e=="update")&&(u.contentType="application/json",u.data=JSON.stringify(t.toJSON())),n.emulateJSON&&(u.contentType="application/x-www-form-urlencoded",u.data=u.data?{model:u.data}:{}),n.emulateHTTP&&(o==="PUT"||o==="DELETE")&&(n.emulateJSON&&(u.data._method=o),u.type="POST",u.beforeSend=function(e){e.setRequestHeader("X-HTTP-Method-Override",o)}),u.type!=="GET"&&!n.emulateJSON&&(u.processData=!1),i.ajax(u)};var g=function(){},y=function(e,t,n){var i;return t&&t.hasOwnProperty("constructor")?i=t.constructor:i=function(){return e.apply(this,arguments)},r.extend(i,e),g.prototype=e.prototype,i.prototype=new g,t&&r.extend(i.prototype,t),n&&r.extend(i,n),i.prototype.constructor=i,i.__super__=e.prototype,i},b=function(e){return!e||!e.url?null:r.isFunction(e.url)?e.url():e.url},w=function(){throw new Error('A "url" property or function must be specified')},E=function(e,t,n){return function(r){e?e(t,r,n):t.trigger("error",t,r,n)}},S=function(e){return e.replace(/&(?!\w+;|#\d+;|#x[\da-f]+;)/gi,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")}}).call(this);